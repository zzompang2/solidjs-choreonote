import{ssrElement as y,escape as f,mergeProps as x,ssr as d,renderToStream as F,ssrHydrationKey as g,isServer as N,getRequestEvent as C,createComponent as c,useAssets as I,NoHydration as E,HydrationScript as B,ssrAttribute as j,Hydration as L}from"solid-js/web";import{lazy as P,createComponent as O,sharedConfig as R,createSignal as _,onCleanup as W,ErrorBoundary as z}from"solid-js";import{provideRequestEvent as J}from"solid-js/web/storage";import{getRequestURL as A,getRequestWebStream as U,getRequestIP as D,setResponseHeader as S,setResponseStatus as b,appendResponseHeader as K,getResponseHeader as V,removeResponseHeader as Y,getCookie as G,setCookie as Q,eventHandler as X,sendRedirect as Z,setHeader as ee}from"h3";function te(e){let t;const r=A(e),n={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(r,{...n,body:e.node.req.body}):new Request(r,{...n,get body(){return t||(t=U(e),t)}})}function ne(e){return e.web??={request:te(e),url:A(e)},e.web.request}const q=Symbol("h3Event"),m=Symbol("fetchEvent"),re={get(e,t){return t===m?e:e[t]??e[q][t]}};function se(e){const t=ne(e);return new Proxy({request:t,clientAddress:D(e),locals:{},[q]:e},re)}function oe(e){if(!e[m]){const t=se(e);e[m]=t}return e[m]}function ae(e){e.forEach(t=>{if(!t.attrs.href)return;let r=document.head.querySelector(`link[href="${t.attrs.href}"]`);r||(r=document.createElement("link"),r.setAttribute("rel","preload"),r.setAttribute("as","style"),r.setAttribute("href",t.attrs.href),document.head.appendChild(r))})}var ie=" ";const le={style:e=>y("style",e.attrs,()=>f(e.children),!0),link:e=>y("link",e.attrs,void 0,!0),script:e=>e.attrs.src?y("script",x(()=>e.attrs,{get id(){return e.key}}),()=>d(ie),!0):null};function w(e){let{tag:t,attrs:{key:r,...n}={key:void 0},children:s}=e;return le[t]({attrs:n,key:r,children:s})}function ce(e,t,r,n="default"){return P(async()=>{{const o=(await e.import())[n],i=(await t.inputs?.[e.src].assets()).filter(u=>u.tag==="style"||u.attrs.rel==="stylesheet");return typeof window<"u"&&ae(i),{default:u=>[...i.map(h=>w(h)),O(o,u)]}}})}const T=[],ue=pe(T.filter(e=>e.type==="page")),de=fe(T.filter(e=>e.type==="api"));function he(e,t){const r=e.replace("","").split("/").filter(Boolean);e:for(const n of de){const s=n.matchSegments;if(r.length<s.length||!n.wildcard&&r.length>s.length)continue;for(let i=0;i<s.length;i++){const l=s[i];if(l&&r[i]!==l)continue e}const o=n[`$${t}`];if(o==="skip"||o===void 0)return;const a={};for(const{type:i,name:l,index:u}of n.params)i===":"?a[l]=r[u]:a[l]=r.slice(u).join("/");return{handler:o,params:a}}}function pe(e){function t(r,n,s,o){const a=Object.values(r).find(i=>s.startsWith(i.id+"/"));return a?(t(a.children||(a.children=[]),n,s.slice(a.id.length)),r):(r.push({...n,id:s,path:s.replace(/\/\([^)/]+\)/g,"")}),r)}return e.sort((r,n)=>r.path.length-n.path.length).reduce((r,n)=>t(r,n,n.path,n.path),[])}function fe(e){return e.flatMap(t=>M(t.path).map(n=>({...t,path:n}))).map(me).sort((t,r)=>r.score-t.score)}function M(e){let t=/(\/?\:[^\/]+)\?/.exec(e);if(!t)return[e];let r=e.slice(0,t.index),n=e.slice(t.index+t[0].length);const s=[r,r+=t[1]];for(;t=/^(\/\:[^\/]+)\?/.exec(n);)s.push(r+=t[1]),n=n.slice(t[0].length);return M(n).reduce((o,a)=>[...o,...s.map(i=>i+a)],[])}function me(e){const t=e.path.split("/").filter(Boolean),r=[],n=[];let s=0,o=!1;for(const[a,i]of t.entries())if(i[0]===":"){const l=i.slice(1);s+=3,r.push({type:":",name:l,index:a}),n.push(null)}else i[0]==="*"?(s-=1,r.push({type:"*",name:i.slice(1),index:a}),o=!0):(s+=4,i.match(/^\(.+\)$/)||n.push(i));return{...e,score:s,params:r,matchSegments:n,wildcard:o}}function ge(){function e(r){return{...r,...r.$$route?r.$$route.require().route:void 0,metadata:{...r.$$route?r.$$route.require().route.metadata:{},filesystem:!0},component:ce(r.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:r.children?r.children.map(e):void 0}}return ue.map(e)}function ye(e){const t=G(e,"flash");if(!t)return;let r=JSON.parse(t);if(!r||!r.result)return[];const n=[...r.input.slice(0,-1),new Map(r.input[r.input.length-1])];return Q(e,"flash","",{maxAge:0}),{url:r.url,result:r.error?new Error(r.result):r.result,input:n}}async function k(e){const t=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,S(e,"Content-Type","text/html"),Object.assign(e,{manifest:await t.json(),assets:[...await t.inputs[t.handler].assets()],initialSubmission:ye(e),routes:ge(),components:{status:n=>(b(e,n.code,n.text),()=>b(e,200)),header:n=>(n.append?K(e,n.name,n.value):S(e,n.name,n.value),()=>{const s=V(e,n.name);if(s&&typeof s=="string"){const o=s.split(", "),a=o.indexOf(n.value);a!==-1&&o.splice(a,1),o.length?S(e,n.name,o.join(", ")):Y(e,n.name)}})},$islands:new Set})}function Se(e,t={}){return X({onRequest:t.onRequest,onBeforeResponse:t.onBeforeResponse,handler:r=>{const n=oe(r);return J(n,async()=>{const s=he(new URL(n.request.url).pathname,n.request.method);if(s){const p=(await s.handler.import())[n.request.method];return n.params=s.params,R.context={event:n},await p(n)}const o=await k(n);let a={...t};if(a.onCompleteAll){const h=a.onCompleteAll;a.onCompleteAll=p=>{$(o)(p),h(p)}}else a.onCompleteAll=$(o);if(a.onCompleteShell){const h=a.onCompleteShell;a.onCompleteShell=p=>{v(o,r)(),h(p)}}else a.onCompleteShell=v(o,r);const i=F(()=>(R.context.event=o,e(o)),a);if(o.response&&o.response.headers.get("Location"))return Z(n,o.response.headers.get("Location"));const{writable:l,readable:u}=new TransformStream;return i.pipeTo(l),u})}})}function v(e,t){return()=>{e.response&&e.response.headers.get("Location")&&(b(t,302),ee(t,"Location",e.response.headers.get("Location")))}}function $(e){return({write:t})=>{const r=e.response&&e.response.headers.get("Location");r&&t(`<script>window.location="${r}"<\/script>`)}}function be(e,t={}){return Se(e,{...t,createPageEvent:k})}var we=["<main",'><h1>Hello world!</h1><button class="increment">Clicks: <!--$-->','<!--/--></button><p>Visit <a href="https://start.solidjs.com" target="_blank">start.solidjs.com</a> to learn how to build SolidStart apps.</p></main>'];function Re(){const[e,t]=_(0);return d(we,g(),f(e()))}function ve(e){if(N){const t=C();t&&W(t.components.status(e))}return null}function $e(e){return c(z,{get fallback(){return c(ve,{code:500})},get children(){return e.children}})}var Ce=["<script",">","<\/script>"],Ee=["<script",' type="module" async',"><\/script>"];const Ae=d("<!DOCTYPE html>");function H(e,t,r=[]){for(let n=0;n<t.length;n++){const s=t[n];if(s.path!==e[0].path)continue;let o=[...r,s];if(s.children){const a=e.slice(1);if(a.length===0||(o=H(a,s.children,o),!o))continue}return o}}function qe(e){const t=C();let r=[];return Promise.resolve().then(async()=>{if(t.routerMatches&&t.routerMatches[0]){const n=[...t.routerMatches[0]];for(;n.length&&(!n[0].metadata||!n[0].metadata.filesystem);)n.shift();const s=n.length&&H(n,t.routes);if(s)for(let o=0;o<s.length;o++){const a=s[o],l=await globalThis.MANIFEST.client.inputs[a.$component.src].assets();r.push.apply(r,l)}else console.warn("No route matched for preloading js assets")}r=[...new Map(r.map(n=>[n.attrs.key,n])).values()].filter(n=>n.attrs.rel==="modulepreload"&&!t.assets.find(s=>s.attrs.key===n.attrs.key))}),I(()=>r.length?r.map(n=>w(n)):void 0),c(E,{get children(){return[Ae,c(e.document,{get assets(){return[c(B,{}),t.assets.map(n=>w(n))]},get scripts(){return[d(Ce,g(),`window.manifest = ${JSON.stringify(t.manifest)}`),d(Ee,g(),j("src",f(globalThis.MANIFEST.client.inputs[globalThis.MANIFEST.client.handler].output.path,!0),!1))]},get children(){return c(L,{get children(){return c($e,{get children(){return c(Re,{})}})}})}})]}})}var Te=['<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico">',"</head>"],Me=["<html",' lang="en">','<body><div id="app">',"</div><!--$-->","<!--/--></body></html>"];const Ne=be(()=>c(qe,{document:({assets:e,children:t,scripts:r})=>d(Me,g(),c(E,{get children(){return d(Te,f(e))}}),f(t),f(r))}));export{Ne as default};
